{% extends "admin/change_form.html" %}
{% load i18n admin_urls unfold %}

{% block field_sets %}
<div class="p-8 pt-0">
  {% for fieldset in adminform %}
    {% include "admin/includes/fieldset.html" %}

    {% if forloop.first %}
      </fieldset>
    </div>

    <div class="p-8">
      <fieldset class="module aligned">
        <h2 class="text-xl font-semibold mb-4">èµ„äº§åˆ—è¡¨ (Asset-level Operations)</h2>
        <div class="overflow-x-auto">
          <table id="asset-list-table" class="min-w-full bg-white border border-gray-200">
            <thead class="bg-gray-50">
              <tr>
                <th class="py-2 px-4 border-b">åºå·</th>
                <th class="py-2 px-4 border-b">èµ„äº§æ ‡é¢˜</th>
                <th class="py-2 px-4 border-b">L1 çŠ¶æ€</th>
                <th class="py-2 px-4 border-b">L2/L3 çŠ¶æ€</th>
                <th class="py-2 px-4 border-b text-center" colspan="2">æ“ä½œ</th>
              </tr>
            </thead>
            <tbody>
              {% if media_items_with_status %}
                {% for item in media_items_with_status %}
                  <tr class="hover:bg-gray-100">
                    <td class="py-2 px-4 border-b">{{ item.media.sequence_number }}</td>
                    <td class="py-2 px-4 border-b">{{ item.media.title }}</td>
                    <td class="py-2 px-4 border-b">{% if item.l1_job %}{{ item.l1_job.get_status_display }}{% else %}æœªåˆ›å»º{% endif %}</td>
                    <td class="py-2 px-4 border-b">{% if item.l2l3_job %}{{ item.l2l3_job.get_status_display }}{% else %}æœªåˆ›å»º{% endif %}</td>
                    <td class="py-2 px-4 border-b">
                        {% if item.l1_job %}
                           {% if item.l1_job.l1_output_file %}
                               <a href="{% url 'workflow:annotation_job_revise_l1' item.l1_job.id %}" class="button" target="_blank">ğŸ” ä¿®è®¢</a>
                           {% else %}
                               <a href="{% url 'workflow:annotation_job_start_l1' item.l1_job.id %}" class="button" target="_blank">â–¶ï¸ å¼€å§‹</a>
                           {% endif %}
                       {% endif %}
                    </td>
                    <td class="py-2 px-4 border-b">
                        </td>
                  </tr>
                {% endfor %}
              {% else %}
                <tr>
                  <td colspan="6" class="py-4 px-4 text-center text-gray-500">æ­¤é¡¹ç›®å…³è”çš„èµ„äº§ä¸‹æ²¡æœ‰æ‰¾åˆ°ä»»ä½•åª’ä½“æ–‡ä»¶ã€‚</td>
                </tr>
              {% endif %}
            </tbody>
          </table>
        </div>
      </fieldset>
    </div>

    <div class="p-8 pt-0">
    {% endif %}
  {% endfor %}
</div>
{% endblock %}