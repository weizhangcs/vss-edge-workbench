{% extends "admin/base_site.html" %}
{% load i18n admin_urls static %}

{% block extrahead %}
    {{ block.super }}
    <style>
        #content { padding: 0 !important; margin: 0 !important; }
        .breadcrumbs { display: none; }
    </style>
{% endblock %}

{% block content %}

{# 1. 数据桥接: 注入 Asset 列表 #}
<script>
    window.SERVER_CONTEXT = {
        // 构建 React Select 需要的 options 数组
        assets: [
            {% for asset in form.fields.target_asset.queryset %}
            {
                "value": "{{ asset.id }}",
                "label": "{{ asset.title|escapejs }} ({{ asset.created|date:'Y-m-d' }})"
            },
            {% endfor %}
        ],
        urls: {
            // 提交给当前 URL
            submit: "{% url 'admin:workflow_annotationproject_import' %}",
            changelist: "{% url 'admin:workflow_annotationproject_changelist' %}"
        }
    };
</script>

{# 2. 挂载点 #}
<div id="react-root" class="bg-white min-h-screen p-6">
    <div class="text-center pt-20">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div>
        <p class="mt-4 text-gray-400">正在加载导入组件...</p>
    </div>
</div>

{# 3. 引用 Vite 构建产物 #}
<script type="module" src="{% static 'js/bundles/annotation-import.js' %}"></script>

{# CSRF Token 占位符 #}
<div style="display:none">
    {% csrf_token %}
</div>

{% endblock %}