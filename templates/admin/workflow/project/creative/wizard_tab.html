{% extends "admin/change_form.html" %}
{% load i18n admin_urls unfold %}

{% block after_field_sets %}

<fieldset class="module aligned mt-6">
    <h2 class="text-xl font-semibold mb-4">创作工作流配置</h2>

    <form action="{{ form_url }}" method="POST">
        {% csrf_token %}
        <div class="p-4 border rounded-md shadow-sm bg-white">
            <p class="text-sm text-gray-700 mb-4">
              {{ help_text }}
            </p>

            {# --- [关键新增] 渲染配置表单 --- #}
            {% if configuration_form %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6 p-4 bg-gray-50 rounded border">
                    {% for field in configuration_form %}
                    <div class="form-group">
                        <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                            {{ field.label }}
                        </label>
                        {{ field }}
                        {% if field.help_text %}
                        <p class="text-xs text-gray-500 mt-1">{{ field.help_text }}</p>
                        {% endif %}
                        {% if field.errors %}
                        <p class="text-xs text-red-500 mt-1">{{ field.errors.0 }}</p>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            {% endif %}
            {# -------------------------------- #}

            <button type="submit"
                   class="button variant-primary {% if trigger_disabled %}disabled{% endif %}"
                   {% if trigger_disabled %}disabled{% endif %}>
              {{ trigger_text }}
            </button>
        </div>
    </form>
</fieldset>

{# ... Inline 子任务列表 ... #}
{% endblock %}