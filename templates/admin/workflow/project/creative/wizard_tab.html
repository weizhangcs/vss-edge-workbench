{% extends "admin/change_form.html" %}
{% load i18n admin_urls unfold %}

{# --- [æ–¹æ¡ˆ B] æ”¾å¼ƒ object-toolsï¼Œç›´æ¥æ’å…¥åœ¨è¡¨å•å†…å®¹çš„æœ€ä¸Šæ–¹ --- #}
{% block content %}

    {# 1. æ˜¾å¼æ¸²æŸ“å·¥å‚å…¥å£æŒ‰é’® #}
    {% if launch_factory_url %}
    <div class="mb-6 p-4 bg-indigo-50 border border-indigo-100 rounded-lg flex items-center justify-between shadow-sm">
        <div class="flex items-center gap-3">
            <div class="p-2 bg-white rounded-full text-indigo-600 shadow-sm">
                <span class="material-symbols-outlined text-2xl">precision_manufacturing</span>
            </div>
            <div>
                <h3 class="text-lg font-bold text-indigo-900">æ‰¹é‡å‚æ•°å·¥å‚ (Pipeline Factory)</h3>
                <p class="text-sm text-indigo-700">åŸºäºå½“å‰é¡¹ç›®çš„é…ç½®ï¼Œæ‰¹é‡ç”Ÿæˆå¤šç‰ˆæœ¬å˜ä½“ã€‚</p>
            </div>
        </div>

        <a href="{{ launch_factory_url }}" class="inline-flex items-center justify-center gap-2 rounded-lg bg-indigo-600 px-4 py-2.5 text-sm font-semibold text-white shadow hover:bg-indigo-500 transition-all">
            ğŸš€ è¿›å…¥å·¥å‚æ¨¡å¼
        </a>
    </div>
    {% else %}
        {% endif %}

    {# 2. è°ƒç”¨çˆ¶ç±»çš„ content (æ¸²æŸ“æ ‡å‡†è¡¨å•) #}
    {{ block.super }}

{% endblock %}


{# --- åŸæœ‰çš„é…ç½®è¡¨å•é€»è¾‘ (ä¿æŒä¸å˜) --- #}
{% block after_field_sets %}

<fieldset class="module aligned mt-6">
    <h2 class="text-xl font-semibold mb-4">åˆ›ä½œå·¥ä½œæµé…ç½®</h2>

    <form action="{{ form_url }}" method="POST">
        {% csrf_token %}
        <div class="p-4 border rounded-md shadow-sm bg-white">
            <p class="text-sm text-gray-700 mb-4">
              {{ help_text }}
            </p>

            {% if configuration_form %}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6 p-4 bg-gray-50 rounded border">
                    {% for field in configuration_form %}
                    <div class="form-group">
                        <label for="{{ field.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">
                            {{ field.label }}
                        </label>
                        {{ field }}
                        {% if field.help_text %}
                        <p class="text-xs text-gray-500 mt-1">{{ field.help_text }}</p>
                        {% endif %}
                        {% if field.errors %}
                        <p class="text-xs text-red-500 mt-1">{{ field.errors.0 }}</p>
                        {% endif %}
                    </div>
                    {% endfor %}
                </div>
            {% endif %}

            <button type="submit"
                   class="button variant-primary {% if trigger_disabled %}disabled{% endif %}"
                   {% if trigger_disabled %}disabled{% endif %}>
              {{ trigger_text }}
            </button>
        </div>
    </form>
</fieldset>

{% endblock %}