{% extends "admin/base_site.html" %}
{% load i18n admin_urls static %}

{# 1. 样式引入 #}
{% block extrahead %}
    {{ block.super }}

    {# 沉浸式布局微调 #}
    <style>
        .breadcrumbs { display: none; }
        /* 避免在 React 加载前看到空白 */
        #react-root { min-height: 80vh; }
    </style>
{% endblock %}

{% block content %}

{# 2. 数据桥接: 后端 -> 前端 #}
<script>
    window.SERVER_CONTEXT = {
        mediaId: "{{ media.id }}",
        mediaTitle: "{{ media.title }}",
        urls: {
            uploadApi: "{% url 'admin:media_assets_asset_batch_upload_api' media.id %}",
            triggerIngest: "{% url 'admin:media_assets_asset_trigger_ingest' media.id %}",
            backToChange: "{% url 'admin:media_assets_asset_change' media.id %}",
            changelist: "{% url 'admin:media_assets_asset_changelist' %}"
        }
    };
</script>

{# 3. 挂载点 #}
<div id="react-root" class="bg-white p-6">
    <div class="text-center pt-32">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600"></div>
        <p class="mt-4 text-gray-400">正在加载批量上传组件...</p>
    </div>
</div>

{# 4. 引用 Vite 构建产物 #}
<script type="module" src="{% static 'js/bundles/media-batch-upload.js' %}"></script>

{# CSRF Token 占位符 (Antd Dragger 会读取 DOM 中的这个 input) #}
<div style="display:none">
    {% csrf_token %}
</div>

{% endblock %}